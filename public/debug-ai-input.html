<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug AI Input</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }

      input[type="range"] {
        width: 100%;
        margin: 10px 0;
      }

      #weightControls {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        border: 1px solid #ddd;
      }

      #weightControls small {
        color: #666;
        font-style: italic;
      }
        input, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
        .section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #fafafa;
        }
        .section h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            background: #f4f4f4;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 13px;
            line-height: 1.4;
        }
        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .stat-item {
            background: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            flex: 1;
        }
        .loading {
            display: none;
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Debug AI Input (Retrieval Only)</h1>
        <p>This tool shows exactly what system message, user message, and document context would be sent to the AI chatbot. <strong>Note: No actual OpenAI API calls are made - this is for debugging the retrieval process only.</strong></p>

        <form id="debugForm">
            <div class="form-group">
                <label for="debugMode">Debug Mode:</label>
                <select id="debugMode">
                    <option value="document">Document Search (Original)</option>
                    <option value="agent">AI Agent Input</option>
                </select>
            </div>

            <div class="form-group">
                <label for="userMessage">User Message:</label>
                <textarea 
                    id="userMessage" 
                    rows="3" 
                    placeholder="Enter the user's question..."
                    required
                >XOLO ‡πÄ‡∏î‡∏≠‡∏∞‡∏°‡∏≠‡∏•‡∏•‡πå‡∏ö‡∏≤‡∏á‡∏Å‡∏∞‡∏õ‡∏¥‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô‡πÑ‡∏´‡∏ô</textarea>
            </div>

            <div id="documentOptions">
                <div class="form-group">
                    <label for="searchType">Search Type:</label>
                    <select id="searchType">
                        <option value="vector">Pure Vector Search (Current)</option>
                        <option value="keyword">Pure Keyword Search</option>
                        <option value="hybrid">Hybrid (Keyword + Vector)</option>
                        <option value="weighted">Weighted Hybrid (Adjustable)</option>
                    </select>
                </div>
            </div>

            <div id="agentOptions" style="display: none;">
                <div class="form-group">
                    <label for="agentId">AI Agent:</label>
                    <select id="agentId">
                        <option value="">Select an AI Agent...</option>
                    </select>
                </div>
            </div>

            <div id="weightControls" class="form-group" style="display: none;">
                <label for="keywordWeight">Keyword Weight: <span id="keywordWeightValue">0.3</span></label>
                <input type="range" id="keywordWeight" min="0" max="1" step="0.1" value="0.3">

                <label for="vectorWeight">Vector Weight: <span id="vectorWeightValue">0.7</span></label>
                <input type="range" id="vectorWeight" min="0" max="1" step="0.1" value="0.7">

                <small>Note: Weights will be normalized to sum to 1.0</small>
            </div>

            <div class="form-group">
                <label for="documentId">Document ID:</label>
                <input 
                    type="number" 
                    id="documentId" 
                    placeholder="e.g. 213" 
                    value="213"
                    required
                >
            </div>

            <div class="form-group">
                <label for="userId">User ID:</label>
                <input 
                    type="text" 
                    id="userId" 
                    placeholder="e.g. 43981095" 
                    value="43981095"
                    required
                >
            </div>

            <button type="submit">üöÄ Debug AI Input</button>
            <div class="loading" id="loading">‚è≥ Analyzing input...</div>
        </form>
    </div>

    <div id="results"></div>

    <script>
      // Handle debug mode changes
      document.getElementById('debugMode').addEventListener('change', function() {
        const debugMode = this.value;
        const documentOptions = document.getElementById('documentOptions');
        const agentOptions = document.getElementById('agentOptions');
        const documentIdGroup = document.querySelector('.form-group:has(#documentId)');

        if (debugMode === 'agent') {
          documentOptions.style.display = 'none';
          agentOptions.style.display = 'block';
          documentIdGroup.style.display = 'none';
          loadAgents();
        } else {
          documentOptions.style.display = 'block';
          agentOptions.style.display = 'none';
          documentIdGroup.style.display = 'block';
        }
      });

      // Handle search type changes
      document.getElementById('searchType').addEventListener('change', function() {
        const searchType = this.value;
        const weightControls = document.getElementById('weightControls');

        if (searchType === 'weighted') {
          weightControls.style.display = 'block';
        } else {
          weightControls.style.display = 'none';
        }
      });

      // Load available agents
      async function loadAgents() {
        try {
          const response = await fetch('/api/agent-chatbots', {
            credentials: 'include'
          });

          if (response.ok) {
            const agents = await response.json();
            const agentSelect = document.getElementById('agentId');
            agentSelect.innerHTML = '<option value="">Select an AI Agent...</option>';

            agents.forEach(agent => {
              const option = document.createElement('option');
              option.value = agent.id;
              option.textContent = `${agent.name} - ${agent.description || 'No description'}`;
              agentSelect.appendChild(option);
            });
          }
        } catch (error) {
          console.error('Failed to load agents:', error);
        }
      }

      // Handle weight slider changes
      document.getElementById('keywordWeight').addEventListener('input', function() {
        const keywordWeight = parseFloat(this.value);
        const vectorWeight = 1.0 - keywordWeight;

        document.getElementById('keywordWeightValue').textContent = keywordWeight.toFixed(1);
        document.getElementById('vectorWeightValue').textContent = vectorWeight.toFixed(1);
        document.getElementById('vectorWeight').value = vectorWeight;
      });

      document.getElementById('vectorWeight').addEventListener('input', function() {
        const vectorWeight = parseFloat(this.value);
        const keywordWeight = 1.0 - vectorWeight;

        document.getElementById('vectorWeightValue').textContent = vectorWeight.toFixed(1);
        document.getElementById('keywordWeightValue').textContent = keywordWeight.toFixed(1);
        document.getElementById('keywordWeight').value = keywordWeight;
      });

      document.getElementById('debugForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const debugMode = document.getElementById('debugMode').value;
        const userMessage = document.getElementById('userMessage').value;
        const userId = document.getElementById('userId').value;

        if (!userMessage.trim()) {
          alert('Please enter a message');
          return;
        }

        const loading = document.getElementById('loading');
        const results = document.getElementById('results');

        loading.style.display = 'block';
        results.innerHTML = '';

        try {
          let response, data;

          if (debugMode === 'agent') {
            const agentId = document.getElementById('agentId').value;
            if (!agentId) {
              alert('Please select an AI Agent');
              loading.style.display = 'none';
              return;
            }

            // Get agent configuration first
            const agentResponse = await fetch(`/api/agent-chatbots/${agentId}`, {
              credentials: 'include'
            });

            if (!agentResponse.ok) {
              throw new Error('Failed to fetch agent configuration');
            }

            const agentConfig = await agentResponse.json();

            // Get agent documents
            const documentsResponse = await fetch(`/api/agent-chatbots/${agentId}/documents`, {
              credentials: 'include'
            });

            let documentIds = [];
            if (documentsResponse.ok) {
              const documents = await documentsResponse.json();
              documentIds = documents.map(doc => doc.id);
            }

            // Generate agent input without actually calling the agent
            data = await generateAgentInput(userMessage, agentConfig, documentIds, userId);
          } else {
            // Original document search mode
            const specificDocumentId = document.getElementById('documentId').value;
            const searchType = document.getElementById('searchType').value;
            const keywordWeight = parseFloat(document.getElementById('keywordWeight').value);
            const vectorWeight = parseFloat(document.getElementById('vectorWeight').value);

            response = await fetch('/api/debug/ai-input', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                userMessage,
                specificDocumentId: specificDocumentId || null,
                userId,
                searchType,
                keywordWeight,
                vectorWeight
              })
            });

            if (!response.ok) {
              throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            const contentType = response.headers.get('content-type');
            if (!contentType || !contentType.includes('application/json')) {
              const text = await response.text();
              throw new Error(`Expected JSON but received ${contentType}. Response: ${text.substring(0, 200)}...`);
            }

            data = await response.json();
          }

          if (data.error) {
              results.innerHTML = `
                  <div class="container">
                      <div class="result" style="border-left-color: #dc3545; background: #f8d7da;">
                          <h3>‚ùå Error</h3>
                          <p>${data.error || 'Failed to debug AI input'}</p>
                      </div>
                  </div>
              `;
          } else {
              displayResults(data);
          }
        } catch (error) {
          results.innerHTML = `
            <div class="container">
              <div class="result" style="border-left-color: #dc3545; background: #f8d7da;">
                <h3>‚ùå Network Error</h3>
                <p>Failed to connect to debug endpoint: ${error.message}</p>
              </div>
            </div>
          `;
        } finally {
          loading.style.display = 'none';
        }
      });

      // Generate agent input for debugging (without actually calling the agent)
      async function generateAgentInput(userMessage, agentConfig, documentIds, userId) {
        try {
          // Build system prompt from agent configuration
          const personality = agentConfig.personality ? `, with a ${agentConfig.personality} personality` : '';
          const profession = agentConfig.profession ? ` as a ${agentConfig.profession}` : '';
          const responseStyle = agentConfig.responseStyle ? ` in a ${agentConfig.responseStyle} style` : '';

          let systemPrompt = `${agentConfig.systemPrompt}

You are ${agentConfig.name || 'an AI assistant'}${profession}${personality}. Respond ${responseStyle}.

Additional skills: ${agentConfig.specialSkills?.join(', ') || 'General assistance'}

Response guidelines:
- Response length: ${agentConfig.responseLength || 'medium'}
- Content filtering: ${agentConfig.contentFiltering ? 'enabled' : 'disabled'}
- Toxicity prevention: ${agentConfig.toxicityPrevention ? 'enabled' : 'disabled'}
- Privacy protection: ${agentConfig.privacyProtection ? 'enabled' : 'disabled'}
- Factual accuracy: ${agentConfig.factualAccuracy ? 'prioritized' : 'standard'}

${agentConfig.allowedTopics?.length > 0 ? `Allowed topics: ${agentConfig.allowedTopics.join(', ')}` : ''}
${agentConfig.blockedTopics?.length > 0 ? `Blocked topics: ${agentConfig.blockedTopics.join(', ')}` : ''}

Memory management: Keep track of conversation context within the last ${agentConfig.memoryLimit || 10} messages.`;

          // Get document context if documents are available
          let documentContext = '';
          if (documentIds && documentIds.length > 0) {
            try {
              const documentsResponse = await fetch('/api/documents', {
                credentials: 'include'
              });

              if (documentsResponse.ok) {
                const allDocuments = await documentsResponse.json();
                const agentDocuments = allDocuments.filter(doc => documentIds.includes(doc.id));

                if (agentDocuments.length > 0) {
                  documentContext = `\n\nRelevant documents for context:\n${agentDocuments.map(doc => 
                    `- ${doc.name}: ${doc.summary || doc.description || 'No summary available'}`
                  ).join('\n')}`;

                  // Add actual document content for better context
                  for (const doc of agentDocuments) {
                    if (doc.content && doc.content.length > 0) {
                      const contentLimit = 5000; // Limit content for display
                      const contentSnippet = doc.content.substring(0, contentLimit) + (doc.content.length > contentLimit ? '...' : '');
                      documentContext += `\n\nContent from ${doc.name}:\n${contentSnippet}`;
                    }
                  }
                }
              }
            } catch (error) {
              console.error('Error fetching documents:', error);
              documentContext = '\n\nError loading document context';
            }
          }

          const fullSystemPrompt = systemPrompt + documentContext;

          return {
            systemMessage: fullSystemPrompt,
            userMessage: userMessage,
            agentConfig: agentConfig,
            documentContext: documentContext,
            documentIds: documentIds,
            agentMode: true
          };
        } catch (error) {
          throw new Error('Failed to generate agent input: ' + error.message);
        }
      }

        function displayResults(data) {
            const results = document.getElementById('results');

            // Handle agent mode display
            if (data.agentMode) {
                results.innerHTML = `
                    <div class="container">
                        <h2>ü§ñ AI Agent Debug Results</h2>

                        <div class="stats">
                            <div class="stat-item">
                                <strong>Agent Name</strong><br>
                                "${data.agentConfig.name || 'Unknown'}"
                            </div>
                            <div class="stat-item">
                                <strong>System Prompt Length</strong><br>
                                ${data.systemMessage.length.toLocaleString()} chars
                            </div>
                            <div class="stat-item">
                                <strong>Documents</strong><br>
                                ${data.documentIds ? data.documentIds.length : 0} linked
                            </div>
                            <div class="stat-item">
                                <strong>Memory Limit</strong><br>
                                ${data.agentConfig.memoryLimit || 10} messages
                            </div>
                        </div>

                        <div class="section">
                            <h3>üéØ Agent Configuration</h3>
                            <pre>${escapeHtml(JSON.stringify(data.agentConfig, null, 2))}</pre>
                        </div>

                        <div class="section">
                            <h3>üìã System Message (AI Instructions)</h3>
                            <pre>${escapeHtml(data.systemMessage)}</pre>
                        </div>

                        <div class="section">
                            <h3>üí¨ User Message</h3>
                            <pre>${escapeHtml(data.userMessage)}</pre>
                        </div>

                        <div class="section">
                            <h3>üìö Input Documents (Source Material)</h3>
                            <p><strong>These are the individual documents that were processed and fed into the AI:</strong></p>
                            ${data.inputDocuments ? data.inputDocuments.map((doc, index) => `
                                <div style="border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 4px; background: #fafafa;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                        <strong>Document ${index + 1}: ${escapeHtml(doc.name || 'Unknown Document')}</strong>
                                        <div style="display: flex; gap: 10px;">
                                            <span style="background: #e3f2fd; padding: 2px 8px; border-radius: 3px; font-size: 12px;">ID: ${doc.id}</span>
                                            <span style="background: #f3e5f5; padding: 2px 8px; border-radius: 3px; font-size: 12px;">Size: ${doc.content ? doc.content.length.toLocaleString() : 0} chars</span>
                                        </div>
                                    </div>
                                    <div style="background: white; padding: 10px; border-radius: 3px; max-height: 300px; overflow-y: auto; font-family: monospace; font-size: 12px; white-space: pre-wrap;">
${escapeHtml(doc.content || 'No content available')}
                                    </div>
                                </div>
                            `).join('') : '<p style="color: #666; font-style: italic;">No input documents available</p>'}
                        </div>

                        <div class="section">
                            <h3>üìÑ Document Context (What the AI sees)</h3>
                            <p><strong>This is the actual document content that gets sent to the AI:</strong></p>
                            <pre>${escapeHtml(data.documentContext)}</pre>
                        </div>
                    </div>
                `;
                return;
            }

            let searchDetailsHtml = '';
            if (data.searchMetrics) {
                const metrics = data.searchMetrics;
                searchDetailsHtml = `
                    <div class="section">
                        <h3>üîç Search Analysis</h3>
                        <div class="stats">
                            <div class="stat-item">
                                <strong>Search Type</strong><br>
                                ${metrics.searchType}
                            </div>
                            <div class="stat-item">
                                <strong>Keyword Results</strong><br>
                                ${metrics.keywordResults || 0}
                            </div>
                            <div class="stat-item">
                                <strong>Vector Results</strong><br>
                                ${metrics.vectorResults || 0}
                            </div>
                            <div class="stat-item">
                                <strong>Combined Results</strong><br>
                                ${metrics.combinedResults || 0}
                            </div>
                        </div>
                        ${metrics.weights ? `
                            <div style="background: #e9ecef; padding: 10px; border-radius: 4px; margin-top: 10px;">
                                <strong>Weight Distribution:</strong><br>
                                Keyword Weight: ${metrics.weights.keyword}<br>
                                Vector Weight: ${metrics.weights.vector}
                            </div>
                        ` : ''}
                        ${metrics.error ? `
                            <div style="background: #f8d7da; padding: 10px; border-radius: 4px; margin-top: 10px; color: #721c24;">
                                <strong>Error:</strong> ${metrics.error}
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            let chunkDetailsHtml = '';
            if (data.chunkDetails && data.chunkDetails.length > 0) {
                chunkDetailsHtml = `
                    <div class="section">
                        <h3>üß© Chunk Analysis</h3>
                        <p><strong>Individual chunk scores and details:</strong></p>
                        <div style="max-height: 400px; overflow-y: auto;">
                            ${data.chunkDetails.map((chunk, index) => `
                                <div style="border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 4px; background: #f9f9f9;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                        <strong>Chunk ${index + 1}</strong>
                                        <div style="display: flex; gap: 15px;">
                                            ${chunk.chunkId ? `<span style="background: #e3f2fd; padding: 2px 8px; border-radius: 3px; font-size: 12px;">ID: ${chunk.chunkId}</span>` : ''}
                                            ${chunk.similarity ? `<span style="background: ${chunk.similarity > 0.8 ? '#c8e6c9' : chunk.similarity > 0.6 ? '#fff3e0' : '#ffcdd2'}; padding: 2px 8px; border-radius: 3px; font-size: 12px;">Similarity: ${chunk.similarity.toFixed(4)}</span>` : ''}
                                            ${chunk.keywordScore ? `<span style="background: #e1f5fe; padding: 2px 8px; border-radius: 3px; font-size: 12px;">KW: ${chunk.keywordScore.toFixed(3)}</span>` : ''}
                                            ${chunk.vectorScore ? `<span style="background: #f3e5f5; padding: 2px 8px; border-radius: 3px; font-size: 12px;">Vec: ${chunk.vectorScore.toFixed(3)}</span>` : ''}
                                        </div>
                                    </div>
                                    <div style="font-size: 13px; color: #666; background: white; padding: 8px; border-radius: 3px; max-height: 150px; overflow-y: auto;">
                                        ${escapeHtml(chunk.content.substring(0, 300))}${chunk.content.length > 300 ? '...' : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            results.innerHTML = `
                <div class="container">
                    <h2>üéØ Debug Results</h2>

                    <div class="stats">
                        <div class="stat-item">
                            <strong>Search Keywords</strong><br>
                            "${data.userMessage}"
                        </div>
                        <div class="stat-item">
                            <strong>Context Length</strong><br>
                            ${data.documentContextLength.toLocaleString()} chars
                        </div>
                        <div class="stat-item">
                            <strong>Vector Search</strong><br>
                            ${data.vectorSearchUsed ? '‚úÖ Used' : '‚ùå Not used'}
                        </div>
                        <div class="stat-item">
                            <strong>Total Chunks</strong><br>
                            ${data.chunkDetails ? data.chunkDetails.length : 0}
                        </div>
                    </div>

                    ${searchDetailsHtml}

                    ${chunkDetailsHtml}

                    <div class="section">
                        <h3>üìã System Message (AI Instructions)</h3>
                        <div style="background: #fff3cd; padding: 10px; border-radius: 4px; margin-bottom: 15px; border-left: 4px solid #ffc107;">
                            <strong>üõë Debug Mode:</strong> This shows what would be sent to OpenAI, but no actual API call is made.
                        </div>
                        <pre>${escapeHtml(data.systemMessage)}</pre>
                    </div>

                    <div class="section">
                        <h3>üí¨ User Message</h3>
                        <pre>${escapeHtml(data.userMessage)}</pre>
                    </div>

                    <div class="section">
                        <h3>üìö Input Documents (Source Material)</h3>
                        <p><strong>These are the individual documents that were processed and fed into the AI:</strong></p>
                        ${data.inputDocuments && data.inputDocuments.length > 0 ? data.inputDocuments.map((doc, index) => `
                                <div style="border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 4px; background: #fafafa;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                        <strong>Document ${index + 1}: ${escapeHtml(doc.name || 'Unknown Document')}</strong>
                                        <div style="display: flex; gap: 10px;">
                                            <span style="background: #e3f2fd; padding: 2px 8px; border-radius: 3px; font-size: 12px;">ID: ${doc.id}</span>
                                            <span style="background: #f3e5f5; padding: 2px 8px; border-radius: 3px; font-size: 12px;">Size: ${doc.content ? doc.content.length.toLocaleString() : 0} chars</span>
                                            ${doc.mimeType ? `<span style="background: #e8f5e8; padding: 2px 8px; border-radius: 3px; font-size: 12px;">Type: ${doc.mimeType}</span>` : ''}
                                        </div>
                                    </div>
                                    ${doc.summary ? `
                                        <div style="background: #fff3cd; padding: 8px; border-radius: 3px; margin-bottom: 10px;">
                                            <strong>Summary:</strong> ${escapeHtml(doc.summary)}
                                        </div>
                                    ` : ''}
                                    ${doc.tags && doc.tags.length > 0 ? `
                                        <div style="margin-bottom: 10px;">
                                            <strong>Tags:</strong> ${doc.tags.map(tag => `<span style="background: #e1f5fe; padding: 2px 6px; border-radius: 2px; font-size: 11px; margin-right: 5px;">${escapeHtml(tag)}</span>`).join('')}
                                        </div>
                                    ` : ''}
                                    <div style="background: white; padding: 10px; border-radius: 3px; max-height: 300px; overflow-y: auto; font-family: monospace; font-size: 12px; white-space: pre-wrap;">
${escapeHtml(doc.content || 'No content available')}
                                    </div>
                                </div>
                            `).join('') : '<p style="color: #666; font-style: italic;">No input documents available</p>'}
                        </div>

                        <div class="section">
                            <h3>üìÑ Document Context (What the AI sees)</h3>
                            <p><strong>This is the actual document content that gets sent to the AI:</strong></p>
                            <pre>${escapeHtml(data.documentContext)}</pre>
                        </div>
                    </div>
                `;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        async function findXolo() {
            try {
                const userId = document.getElementById('userId').value;
                if (!userId) {
                    alert('Please enter a User ID');
                    return;
                }

                console.log('Searching for XOLO across all documents...');
                const response = await fetch(`/api/debug/find-xolo/${userId}`);
                const data = await response.json();

                console.log('=== XOLO SEARCH RESULTS ===');
                console.log('Total documents:', data.totalDocuments);
                console.log('Documents with XOLO:', data.documentsWithXolo.length);
                console.log('Vector results with XOLO:', data.summary.foundInVector);

                if (data.documentsWithXolo.length > 0) {
                    console.log('\n=== DOCUMENTS CONTAINING XOLO ===');
                    data.documentsWithXolo.forEach(doc => {
                        console.log(`\nDocument ${doc.documentId}: ${doc.documentName}`);
                        console.log(`Found terms: ${doc.foundTerms.join(', ')}`);
                        console.log(`Has vector data: ${doc.hasVectorData}`);
                        console.log('Sample lines:');
                        doc.matchingLines.forEach(line => console.log(`  - ${line.substring(0, 200)}`));
                    });
                } else {
                    console.log('‚ùå NO XOLO FOUND IN ANY DOCUMENT');
                }

                if (data.vectorResults && data.vectorResults.length > 0) {
                    console.log('\n=== VECTOR SEARCH RESULTS ===');
                    data.vectorResults.forEach((result, index) => {
                        console.log(`\nVector result ${index + 1}:`);
                        console.log(`Document ID: ${result.documentId}`);
                        console.log(`Similarity: ${result.similarity}`);
                        console.log(`Contains XOLO: ${result.hasXolo}`);
                        console.log(`Content preview: ${result.content.substring(0, 200)}...`);
                    });
                }

                alert(`XOLO Search Complete!\nFound in ${data.documentsWithXolo.length} documents\nCheck console for details`);

            } catch (error) {
                console.error('XOLO search failed:', error);
                alert('XOLO search failed: ' + error.message);
            }
        }
    </script>
</body>
</html>