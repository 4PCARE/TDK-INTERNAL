LINE OA: Found 5 assigned documents for agent 10
üîç LINE OA: Starting conversational keyword optimization for: "‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô‡πÑ‡∏´‡∏ô"
üîç Optimizing keywords for query: ‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô‡πÑ‡∏´‡∏ô
üìù Using conversation context with 8 messages
Failed to parse AI response as JSON: ```json
{
  "optimizedKeywords": ["XOLO", "‡∏ä‡∏±‡πâ‡∏ô‡πÑ‡∏´‡∏ô", "‡πÄ‡∏î‡∏≠‡∏∞‡∏°‡∏≠‡∏•‡∏•‡πå"],
  "searchQuery": "XOLO ‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô‡πÑ‡∏´‡∏ô ‡πÄ‡∏î‡∏≠‡∏∞‡∏°‡∏≠‡∏•‡∏•‡πå",
  "confidence": 0.95,
  "reasoning": "‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏ñ‡∏∂‡∏á‡∏£‡πâ‡∏≤‡∏ô 'XOLO' ‡πÅ‡∏•‡∏∞‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡πÄ‡∏î‡∏≠‡∏∞‡∏°‡∏≠‡∏•‡∏•‡πå ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏∂‡∏á‡∏£‡∏ß‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô"
}
```
‚úÖ Keyword optimization result: {
  original: '‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô‡πÑ‡∏´‡∏ô',
  optimized: '‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô‡πÑ‡∏´‡∏ô ‡∏ä‡∏±‡πâ‡∏ô',
  keywords: [ '‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô‡πÑ‡∏´‡∏ô', '‡∏ä‡∏±‡πâ‡∏ô' ],
  confidence: 0.7
}
‚úÖ LINE OA: Keyword optimization successful!
   üìù Original query: "‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô‡πÑ‡∏´‡∏ô"
   üéØ Optimized query: "‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô‡πÑ‡∏´‡∏ô ‡∏ä‡∏±‡πâ‡∏ô"
   üîß Keywords: [‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô‡πÑ‡∏´‡∏ô, ‡∏ä‡∏±‡πâ‡∏ô]
   üìä Confidence: 0.7
   üí≠ Reasoning: ‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å AI ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÑ‡∏î‡πâ
LINE OA: Using 5 documents for hybrid search
LINE OA: Performing hybrid search with document restriction to 5 documents: [217, 216, 214, 213, 211]
LINE OA: Hybrid search failed, using fallback: TypeError: Cannot read properties of undefined (reading 'hybridSearch')
    at handleLineWebhook (/home/runner/workspace/server/lineOaWebhook.ts:1253:58)
    at async <anonymous> (/home/runner/workspace/server/routes.ts:5070:14)
üîç Debug: Getting agent 10 for user 43981095
‚úÖ Found agent: 4Plus TMG Customer V2
üñºÔ∏è Image-related query detected: false
üîç User message for analysis: "‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡πâ‡∏ô‡πÑ‡∏´‡∏ô"
üìö Fetching chat history (limit: 10) for channel type: lineoa
üìö Retrieved 10 messages for memory (limit: 10)
üìä Message type breakdown: { user: 5, assistant: 4, system: 1 }
üìù Found 10 previous messages (all types included)
üìö Found 5 documents for agent
‚ùå Line OA: Vector search failed, using fallback: Error [TransformError]: Transform failed with 2 errors:
/home/runner/workspace/server/services/unifiedSearchService.ts:206:13: ERROR: Multiple exports with the same name "unifiedSearchService"
/home/runner/workspace/server/services/unifiedSearchService.ts:206:13: ERROR: The symbol "unifiedSearchService" has already been declared
    at failureErrorWithLog (/home/runner/workspace/node_modules/tsx/node_modules/esbuild/lib/main.js:1476:15)
    at /home/runner/workspace/node_modules/tsx/node_modules/esbuild/lib/main.js:755:50
    at responseCallbacks.<computed> (/home/runner/workspace/node_modules/tsx/node_modules/esbuild/lib/main.js:622:9)
    at handleIncomingPacket (/home/runner/workspace/node_modules/tsx/node_modules/esbuild/lib/main.js:677:12)
    at Socket.readFromStdout (/home/runner/workspace/node_modules/tsx/node_modules/esbuild/lib/main.js:600:7)
    at Socket.emit (node:events:524:28)
    at addChunk (node:internal/streams/readable:561:12)
    at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
    at Readable.push (node:internal/streams/readable:392:5)
    at Pipe.onStreamRead (node:internal/stream_base_commons:191:23)
‚úÖ Built context with 3 documents
üìÑ Context prompt length: 9227 characters
üì∏ Image context extracted: 846 characters
‚úÖ Image analysis found: 
=== ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ===